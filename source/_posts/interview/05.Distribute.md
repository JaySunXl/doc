---
title: 面试准备:分布式
date: 2018-03-20
tags:
- Java
categories:
- 面试
---
<!-- TOC -->

- [分布式原理](#分布式原理)
    - [一致性 Hash](#一致性-hash)
    - [分布式事务](#分布式事务)
    - [分布式锁](#分布式锁)
    - [分布式Session](#分布式session)
- [反向代理](#反向代理)
- [负载均衡](#负载均衡)
- [消息队列](#消息队列)
- [RPC](#rpc)
- [微服务](#微服务)
- [参考](#参考)

<!-- /TOC -->

# 分布式原理

分布式:将功能拆分,分布在不同节点上
集群:不拆分功能,不同及节点上的功能是相同的

CAP原理:

1. Consistency(一致性):所有节点获取到的数据一致
2. Availability(可用性):每次请求都能提供服务,但不能保证提供的是最新数据
3. Partition tolerance(分区容错性):分布式某节点故障也能正常提供满足一致性和可用性的服务

其中P是至关重要的,否则也就没有分布的必要了,面临的也往往是C和A的取舍.另外,三选二的说法也有误导性,可[阅读][1].

BASE原理:

1. Basically Available(基本可用):允许损失部分可用性
2. Soft-state(软状态):允许降低一致性
3. Eventual Consistency(最终一致性)

主要实现是对业务数据进行拆分,如数据库服务的分库,分表等

一致性:

强一致性(即时一致性):如线程1的修改能让其他线程立刻读到.
弱一致性:如线程1的修改不用让其他线程立刻读到.
最终一致性:弱一致性情况下,线程1修改后没有被其他线程修改,那么其他线程最终都能读到线程1的修改

如何保证消息的一致性

## 一致性 Hash

一nginx多Tomcat的场景下,nginx选用怎样的策略将请求分发到不同的Tomcat上处理,增减tomcat该怎么办?
一个优秀的分布式hash算法,需要满足:

* 均衡性(Balance):hash结果均匀的分布在域上
* 单调性(Monotonicity):增减节点时,尽量避免处理某请求的节点发生改变,或尽量少的发生变化
* 分散性(Spread):处理同一用户的请求时,不会因为客户端(如IP)发生变化而改变处理的节点
* 负载(Load):

解决方案:环形Hash,可[阅读][2]

## 分布式事务

实现方案:两阶段提交(Two-phase Commit，2PC)

准备阶段:协调者确认所有事务参与者是否可以提交
提交阶段:所有参与者全部回复可以,协调者协调参与者提交事务

具有的问题:

* 参与者阻塞:参与者相应协调者时,其他参与者处于等待状态
* 协调者太过重要:协调者一旦故障,整个结构将不可用
* 数据一致性:部分参与者提交时发生故障,导致数据一致性问题
* 保守:一个参与者的事务失败,所有参与者的事务全部回滚

实现方案:消息事务

基于消息中间件的两阶段提交,如RocketMQ,将分布式事务拆分成本地事务进行处理.
以转账为例,事务1扣钱成功,同时发出消息,通知事务2加钱.

具体的实现有课分为两种:本地消息表与事务消息

![](https://raw.githubusercontent.com/LuVx21/hexo/master/source/_posts/interview/img/xa_mq.png)

事务消息方式:
1. 事务A发送事务执行预备消息
2. 收到MQ回复后执行事务
3. 根据执行的结果决定提交还是回滚消息

![](https://raw.githubusercontent.com/LuVx21/hexo/master/source/_posts/interview/img/xa_mq1.png)

实现方案:TCC

Try,Commit,Cancel

## 分布式锁

如何实现分布式锁

## 分布式Session

如何实现分布式Session

# 反向代理

Nginx的Master和Worker,Nginx是如何处理请求的;

# 负载均衡

什么是客户端负载均衡策略、什么是服务器端负载均衡策略;
如何实现负载均衡,有哪些算法可以实现？
CDN实现原理
怎么提升系统的QPS和吞吐量
描述一个服务从发布到被消费的详细过程
分布式系统怎么做服务治理
接口的幂等性的概念
消息中间件如何解决消息丢失问题
重连机制会不会造成错误

Zookeeper的用途,选举的原理是什么？
zookeeper原理和适用场景
zookeeper watch机制

数据的垂直拆分水平拆分。
redis/zk节点宕机如何处理
分布式集群下如何做到唯一序列号
列举出你能想到的数据库分库分表策略;分库分表后,如何解决全表查询的问题
分库与分表带来的分布式困境与应对之策;
Solr如何实现全天24小时索引更新;


# 消息队列

用过哪些MQ,怎么用的,和其他mq比较有什么优缺点,MQ的连接是线程安全的吗
MQ系统的数据如何保证不丢失
消息队列使用的场景介绍和作用(应用耦合、异步消息、流量削锋等);
如何解决消息队列丢失消息和重复消费问题;
Kafka使用过吗,什么是幂等性？怎么保证一致性,持久化怎么做,分区partition的理解,LEO是什么意思,如何保证多个partition之间数据一致性的(ISR机制),为什么Kafka可以这么快(基于磁盘的顺序读写);
异步队列怎么实现;
你项目的并发是多少？怎么解决高并发问题？单机情况下Tomcat的并发大概是多少,MySQL的并发大致是多少？
什么是C10K问题;
高并发情况下怎么办;
分布式理论,什么是CAP理论,什么是Base理论,什么是Paxos理论;
分布式协议的选举算法;


# RPC


Dubbo的底层实现原理和机制
Dubbo的服务请求失败怎么处理
Dubbo的基本原理,RPC,支持哪些通信方式,服务的调用过程;
Dubbo如果有一个服务挂掉了怎么办;
分布式事务,操作两个表不在一个库,如何保证一致性。
分布式系统中,每台机器如何产生一个唯一的随机值;
系统的量级、pv、uv等;
什么是Hash一致性算法？分布式缓存的一致性,服务器如何扩容(哈希环);
如何优化Tomcat,常见的优化方式有哪些;


# 微服务

说一下你对微服务的理解,与SOA的区别;
SOA:服务治理

# 参考

[1]:http://www.cnblogs.com/hxsyl/p/4381980.html
[2]:https://segmentfault.com/a/1190000013533592


[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)