---
title: 面试准备:数据库
date: 2018-03-20
tags:
- MySQL
categories:
- 面试
---

<!-- TOC -->

- [](#)
- [事务](#事务)
- [锁](#锁)
- [优化](#优化)
- [读写分离](#读写分离)
    - [分表](#分表)
    - [分库](#分库)
    - [主从复制](#主从复制)

<!-- /TOC -->

# 

mysql的各个引擎
索引类型
InnoDB引擎的索引实现,了解B+树和B树
聚簇索引和非聚簇索引
sql优化, 索引覆盖,延迟关联

* 原子性(Atomicity)
* 一致性(Consistency)
* 隔离性(Isolation)
* 持久性(Durability)

# 事务

* 脏读:当前事务读取到未提交事务中的修改
* 不可重复读:在同一事务中两次读取的数据不一致(由其他事务修改现有数据引起)
* 幻读:简单的可以理解为在同一事务中两次读取的数据条数不一致(有其他事务增删数据引起)

事务隔离级别:

* 未提交读(Read uncommitted):最低级别,任何情况都无法保证,会发生脏读,不可重复读
* 提交读(Read committed):可避免脏读,会发生不可重复读
* 可重复读(Repeatable read):会发生幻读(虚读),可避免脏读、不可重复读,MySQL默认隔离级别
* 可串行化(Serializable):强制事务串行执行,可避免脏读、不可重复读、幻读

**mysql如何解决幻读,如何解决不可重复读, 了解MVCC和next-key锁**

InnoDB和XtraDB存储引擎通过版本并发控制MVCC(Multiversion Concurrency Control)解决了幻读问题.

通常涉及到写操作都是要阻塞的,如读写,写读,使用MVCC后,只有写写会阻塞.

节选自[MySQL-InnoDB-MVCC多版本并发控制](https://segmentfault.com/a/1190000012650596)


***INT(11)的11代表什么, varchar(11)中的11呢***

# 锁

锁的级别:
表级:直接锁定整张表,在你锁定期间,其它进程无法对该表进行写操作.如果你是写锁,则其它进程则读也不允许
行级:仅对指定的记录进行加锁,这样其它进程还是可以对同一个表中的其它记录进行操作.
页级:表级锁速度快,但冲突多,行级冲突少,但速度慢.所以取了折衷的页级,一次锁定相邻的一组记录.

# 优化

* 分表:行分表,列分表
* 索引
* sql语句

慢查询

# 读写分离

## 分表

水平切分:把一个表的数据分到多个表中,每个表的字段相同,能够提高查询性能,但由于数据仍然处于同一个库中,库级别仍有IO瓶颈
垂直切分:把一个表的字段分到多个表中,每个表的字段不同

分表策略:
随机切分:hash,mod
连续切分

带来的问题:

表关联
分布式事务:数据一致性
数据id问题:如MySQL不能使用自增的id,而应该使用全局唯一id,如UUID等

## 分库

水平分:适用于单表中数据量极大的场景,被分成的表处于不同的库中,这也是和水平分表的不同
垂直分:适用于单库中表的数量较多的场景,如把一个表分到一个单独的库中

实现简单
存在跨库join查询问题,无法解决单表数据量大的问题

解决跨库join的方案:

常被join的表在每个库中都存留一份.但要求这些表很少被修改
表中保存"多余"的字段,避免通过join去其他表获取该字段,是一种空间换性能的方案

## 主从复制

读写分离存在的问题:

连接池隔离
主从同步延迟

解决方案:

适当放弃一致性
一致性要求强的机能无论读写都使用master库
弱一致性(最终一致性)的机能使用读写分离


<!--
InnoDB的插入缓冲和两次写的概率和意义;
如果建了⼀个单列索引,查询的时候查出2列,会⽤到这个单列索引吗？（会用到）
如果建了⼀个包含多个列的索引,查询的时候只⽤了第⼀列,能不能⽤上这个索引？查三列呢？
接上题,如果where条件后⾯带有⼀个 i + 5 < 100 会使⽤到这个索引吗？
like %aaa%会使⽤索引吗? like aaa%呢?
drop、truncate、delete的区别？
平时你们是怎么监控数据库的? 慢SQL是怎么排查的？（慢查询日志）
你们数据库是否⽀持emoji表情,如果不⽀持,如何操作?选择什么编码方式？如果支持一个表情占几个字节?(utf8mb4);
如果查询很慢,你会想到的第⼀个⽅式是什么？（数据库索引）
数据库索引,什么是全文索引,全文索引中的倒排索引是什么原理;
数据库最佳左前缀原则是什么？
数据库的三大范式;
悲观锁和乐观锁的原理和应用场景;
左连接、右连接、内连接、外连接、交叉连接、笛卡儿积等;
一般情况下数据库宕机了如何进行恢复（什么是Write Ahead Log机制,什么是Double Write机制,什么是Check Point）;
什么是redo日志、什么是undo日志;
数据库中的隔离性是怎样实现的;原子性、一致性、持久性又是如何实现的;
什么是组合索引,组合索引什么时候会失效;
关系型数据库和非关系型数据库区别;
数据库死锁如何解决;
MySQL并发情况下怎么解决（通过事务、隔离级别、锁）;
MySQL中的MVCC机制是什么意思,根据具体场景,MVCC是否有问题;
-->