<details>
<summary>执行计划</summary>
<!-- TOC -->

- [explain](#explain)
- [id](#id)
- [select_type](#select_type)
- [type](#type)
- [ref](#ref)
- [Extra](#extra)
- [扩展](#扩展)

<!-- /TOC -->
</details>


```sql
create table `user` (
  `user_id` bigint(20) not null auto_increment,
  `user_name` varchar(255) not null default 'default',
  `password` varchar(255) not null default 'default',
  `age` int(11) not null default '0',
  primary key (`user_id`) using btree
) engine=innodb auto_increment=1 default charset=utf8;
```

## explain

`explain select * from user where userid >= 2\G;`

| 字段                   | 说明                              |
| :--------------------- | :-------------------------------- |
| id: 1                  |                                   |
| select_type: SIMPLE    | 查询类型:简单, 联合, 字查询       |
| table: user            | 表名                              |
| partitions: NULL       |                                   |
| type: range            | 检索类型                          |
| possible_keys: PRIMARY | 可能使用的索引                    |
| key: PRIMARY           | 实际使用的索引                    |
| key_len: 8             | 最长索引宽度, 其值越小越好        |
| ref: NULL              | 显示哪个字段或常数与key一起被使用 |
| rows: 2                | 遍历多少条数据找到结果            |
| filtered: 100.00       |                                   |
| Extra: Using where     | 执行状态说明                      |

## id

id值可以相同也可以不同, 相同时执行顺序由上往下, 不同时由大到小

## select_type

查询类型, 用于区别普通查询, 联合查询和子查询等

有`simple, primary, subquery, derived, union, union result`等类型

## type

其取值依照优劣依次为:
`system > const > eq_ref > ref > fulltext > ref_or_null > index_merge > unique_subquery > index_subquery > range > index > ALL`

1. consts 单表中最多只有一个匹配行(主键或者唯一索引), 在优化阶段即可读取到数据.
2. ref 指的是使用普通的索引(normal index).
3. range 对索引进行范围检索.
4. index 使用了索引扫描来做排序

至少要达到 range 级别, 要求是 ref 级别, 如果可以是 consts 最好

const代表一次就命中, ALL代表全表扫描后才确定结果, 通常得保证查询至少达到range级别, 最好能达到ref

## ref

显示索引的哪一字段被使用了, 哪些字段或常量值被用于查询索引列上的值

## Extra

如果是Using filesort或Using temporary则需要对SQL进行优化

* `filesort`: 无法利用索引完成的排序
* `temporary`: 使用临时表保存中间结果, 常见于`order by`和`group by`
* `index`: 使用索引查询, 常和`using where`一起出现, 表示使用索引字段进行了筛选
* `where`: 未使用索引的条件查询 

```sql
select * from user where user_id = (
select user_id from user where user_name = 'foo'
);
```
结果如下:
```
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
|  1 | PRIMARY     | user  | NULL       | const | PRIMARY       | PRIMARY | 8       | const |    1 |   100.00 | NULL        |
|  2 | SUBQUERY    | user  | NULL       | ALL   | NULL          | NULL    | NULL    | NULL  |    4 |    25.00 | Using where |
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
```

## 扩展

```
explain extended sql;
```
根据执行计划反向推出select语句, 使用`show warnings`即可查询优化后的sql,
不过`extended`已经被废弃, 所以还是谨慎使用


[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)

