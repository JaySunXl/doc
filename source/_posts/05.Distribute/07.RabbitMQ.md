---
title: 消息队列:RabbitMQ
date: 
tags:
- MQ
---
<!-- TOC -->

- [关于](#关于)
- [RabbitMQ](#rabbitmq)
- [Exchange](#exchange)
- [Kafka](#kafka)
- [比较](#比较)
- [Q&A](#qa)
- [参考](#参考)

<!-- /TOC -->


# 关于

# RabbitMQ

主体:

* Producer
* Exchange:收到Producer的消息,解析得到Routing Key
* Binding:用于关联Exchange和Queue,得到Binding Key,匹配消息的Routing Key,将消息发送到对应的Queue
* Queue:存储未消费的消息
* Channel:只有通过Channel才能执行AMQP命令,一个Connection包含多个channel
* Connection:消费者和Broker之间的TCP连接
* Consumer:

![rabbitmq消息流程](https://raw.githubusercontent.com/LuVx21/hexo/master/source/_posts/99.img/rabbitmq_msg.png)

> 由Exchange,Binding和Queue共同组成broker,线程之间尽量复用Connection,不要复用channel

# Exchange

支持一下四种分发策略:

* direct:Binding Key和Routing Key完全一致才会发送消息
* fanout:不处理Routing Key,直接发送消息到所有与该Exchange绑定的队列
* topic:支持通配符的匹配模式,`#`匹配0个或多个单词，`*`匹配一个单词
* headers:几乎不用

# Kafka

在大数据领域的实时计算以及日志采集方面被大规模使用(主要用于处理活跃的流式数据),基于TCP协议通信.

特点:

* 同时为发布,订阅提供高吞吐量
* 支持持久化操作
* 分布式系统,易扩展
* 支持online,offline场景

主体:

* producer:向topic发布消息
* Message:消息,通信的基本单位,不在内存中缓存,而是持久化,充分利用磁盘的顺序读写性能
* Topic:消息源的不同分类
* Partition:一个topic可分为多个partition,每个partition是一个队列
* broker:缓存代理,Kafka集群中的一台或多台服务器的统称
* consumer:订阅topic并处理其发布的消息

![kafka消息流程](https://raw.githubusercontent.com/LuVx21/hexo/master/source/_posts/99.img/kafka_msg.png)

应用场景:

* 消息队列
* 行为跟踪
* 日志收集
* 流处理
* 持久化日志

# 比较

| 特性     | RabbitMQ | Kaka |
| :--- | :--- | :--- |
| 应用场景 | 实时的,高可靠性消息传递 | 用于处理活跃的流式数据,大数据量的数据处理 |
| 架构模型 | AMQP,有消息确认机制 | 无消息确认机制 |
| 吞吐量   | 吞吐量稍逊Kafka,支持消息的可靠传输,事务,不支持批量操作,消息存储可以采用内存磁盘 | 高吞吐量,消息批量处理, zero-copy机制,消息的存取是本地磁盘顺序读取,具有O(1)复杂度,消息处理效率高 |
| 可用性   | 支持 miror queue | broker支持主备模式 |
| 负载均衡 | 本身不支持 | 采用ZooKeeper,依赖其协调机制 |
| 其他 | 消息应尽量小, 只用于处理实时且要高可靠性的消息,生产者和消费者能力尽量对等 | 消息丢失不敏感,实时性稍逊rabbitmq,是一个好的运维监视系统 |


# Q&A

***用过哪些MQ,怎么用的,和其他mq比较有什么优缺点,MQ的连接是线程安全的吗***

# 参考

1. [RabbitMQ的应用场景以及基本原理介绍](https://blog.csdn.net/whoamiyang/article/details/54954780)


[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)