<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [不可变集合](#不可变集合)
- [特殊集合](#特殊集合)
    - [Multimap](#multimap)
    - [BiMap](#bimap)
    - [Multiset](#multiset)
    - [Table](#table)
- [工具方法](#工具方法)

<!-- /TOC -->
</details>

## 不可变集合

提供了各种以`Immutable`开头的集合类, 这样的都是不可变集合

以`ImmutableList`为例, 它继承自 `ImmutableCollection`抽象类, 在抽象层中, 对所有的集合所具有的写操作都进行了抛出`UnsupportedOperationException`处理, 同时标记为废弃

以`ImmutableList.of("a", "b");`进行内部分析,

```Java
public static <E> ImmutableList<E> of(E e1, E e2) {
    return construct(e1, e2);// 复数个的参数都是调用此方法
}
private static <E> ImmutableList<E> construct(Object... elements) {
    // 先进行非空判断, 不可变集合中不接受null值
    return asImmutableList(checkElementsNotNull(elements));
}
.......
static <E> ImmutableList<E> asImmutableList(Object[] elements) {
    return asImmutableList(elements, elements.length);
}
static <E> ImmutableList<E> asImmutableList(Object[] elements, int length) {
    switch (length) {
        case 0:
        return of();
        case 1:
        return of((E) elements[0]);
        default:
        if (length < elements.length) {// 以防万一的操作
            elements = Arrays.copyOf(elements, length);
        }
        return new RegularImmutableList<E>(elements);
    }
}
```

最终创建了 `RegularImmutableList` 类对象, 此类继承自 `ImmutableList`

## 特殊集合

### Multimap

一k对多v map: Multimap, HashMultimap, ArrayListMultimap等

虽然结构很相似但此类型并没有实现Map接口

```Java
Multimap<String, String> map = HashMultimap.create();
```

```Java
// 存储容器, v 为集合, 实际是一个 set
private transient Map<K, Collection<V>> map;
public boolean put(@Nullable K key, @Nullable V value) {
    Collection<V> collection = map.get(key);// 得到值存储的集合
    if (collection == null) {
        collection = createCollection(key);// HashMultimap中实现, 创建一个 set
        if (collection.add(value)) {
        totalSize++;
        map.put(key, collection);
        return true;
        } else {
        throw new AssertionError("New Collection violated the Collection spec");
        }
    } else if (collection.add(value)) {
        totalSize++;
        return true;
    } else {
        return false;
    }
}
// 查
public Collection<V> get(@Nullable K key) {
    Collection<V> collection = map.get(key);
    if (collection == null) {
        collection = createCollection(key);
    }
    // 以获取到的集合, 封装一个集合返回
    return wrapCollection(key, collection);
}
Collection<V> wrapCollection(K key, Collection<V> collection) {
    return new WrappedSet(key, (Set<V>) collection);
}
```

可以看到, 这个类型的集合, 没有实现 Map 接口, 但内部确实使用的 Map 作为存储容器

其内部操作也依托了 Map 的方法实现, 观察类图可以发现, 抽象层中有个 `AbstractMapBasedMultimap`, 从名称可以看出是基于 Map 的实现

同样的, value可以是一个Set, 也可以是一个 List, 如`ArrayListMultimap`则是使用的 List

### BiMap

k-v中, v也唯一的map : BiMap

```Java
BiMap<String, String> dbShortNameMap = HashBiMap.create();
```

```Java
// 分割集合
Lists.partition(users, 50)
```

