<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [模板方法模式](#模板方法模式)
- [Usage](#usage)
- [jdk中的使用](#jdk中的使用)

<!-- /TOC -->
</details>

## 模板方法模式


某一个大行为有多个子行为组成, 而在行为内部, 子行为的执行具有特定的顺序且行为的某些子行为大致确定, 某些却不确定.

因此可以将确定的不太可能改变的行为放在抽象层, 而不确定的行为延迟到子类中实现.

## Usage

现在很多网站都支持多种登录方式, 以此为例分析一下, 将登录过程简略为以下3步:
1. 登录环境安全性检测
2. 登录
3. 页面跳转

```Java
interface Login {
    /**
     * 登录环境安全性检查
     */
    default void envCheck() {
        System.out.println("检查当前登录环境......当前登录环境无风险");
    }

    /**
     * 登录功能, 支持不同的登录方式
     * 账号密码
     * 手机验证码
     * 社交网络账号
     */
    void doLogin();

    /**
     * 登录
     */
    default void login() {
        envCheck();
        doLogin();
        pageSwitch();
    }

    /**
     * 登录后页面跳转
     */
    default void pageSwitch() {
        System.out.println("登录成功, 跳转至主页面, 请稍后\n");
    }
}
```

定义两个登录的功能:
```Java
public class LoginByPhone implements Login {
    @Override
    public void doLogin() {
        System.out.println("使用手机验证码登录");
    }
}
public class LoginByPwd implements Login {
    @Override
    public void doLogin() {
        System.out.println("使用账户密码登录");
    }
}
```

使用时即可根据用户选择合适的登录方式登录, 其中的`login()`即是模板方法

Java发展至今, 有更灵活的方式来实现模板方法, 如上述接口即是函数式接口, 可以使用Lambda方式快速实现方法

[Effective Java 第三版 - 44. 优先使用标准的函数式接口](https://www.jianshu.com/p/56e1ef91e34e)

现在Java已经有lambda表达式, 编写API的最佳实践已经发生了很大的变化.
例如, 模板方法模式[Gamma95], 其中一个子类重写原始方法以专门化其父类的行为, 变得没有那么吸引人.
现代替代的选择是提供一个静态工厂或构造方法来接受函数对象以达到相同的效果.
通常地说, 可以编写更多以函数对象为参数的构造方法和方法. 选择正确的函数式参数类型需要注意.

## jdk中的使用

aqs中, 加锁和释放锁的过程中, 都有一个`try`的操作, 这个操作即是模板方法, 不同的锁类型在加/释放锁时的行为有锁差别

[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)
