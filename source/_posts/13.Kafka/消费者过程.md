<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [自动提交偏移量](#自动提交偏移量)
- [手动提交偏移量](#手动提交偏移量)
- [监听消费组再平衡](#监听消费组再平衡)

<!-- /TOC -->
</details>


consumer 采用 pull(拉)模式从 broker 中读取数据

消费消息时, 以下三个配置是必需的:
* `bootstrap.servers`: 指定 broker 的地址清单
* `key.deserializer`: 指定键的反序列化器
* `value.deserializer`: 指定值的反序列化器


一个分区只能被同一个消费者群组里面的一个消费者读取，不能被同一个消费者群里多个消费者共同读取



偏移量:

＿consumer_offset 内消息的结构

## 自动提交偏移量

有重复消费的风险

## 手动提交偏移量

同步提交/异步提交

```Java
consumer.commitSync();

consumer.commitAsync(new OffsetCommitCallback() {
        @Override
        public void onComplete(Map<TopicPartition, OffsetAndMetadata> offsets, Exception exception) {
            if (exception != null) {
                System.out.println("错误处理");
                offsets.forEach(
                    (k, v) -> System.out.printf(
                        "topic = %s, partition = %d, offset = %s \n", k.topic(), k.partition(), v.offset())
                );
            }
        }
    });
```


提交指定偏移量
```Java
/*同步提交特定偏移量*/
commitSync(Map<TopicPartition, OffsetAndMetadata> offsets) 
/*异步提交特定偏移量*/    
commitAsync(Map<TopicPartition, OffsetAndMetadata> offsets, OffsetCommitCallback callback)
```

## 监听消费组再平衡

subscribe(Collection<String> topics, ConsumerRebalanceListener listener)

监听器中的`onPartitionsRevoked`方法
会在消费者停止读取消息之后，再均衡开始之前就调用

`onPartitionsAssigned` 方法会在再平衡后, 读取消息前调用

