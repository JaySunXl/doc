<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [双写一致性](#双写一致性)

<!-- /TOC -->
</details>

## 双写一致性

**如何保证缓存与数据库的双写一致性?**

读的时候, 先读缓存, 缓存没有的话, 就读数据库, 然后取出数据后放入缓存, 同时返回响应.
更新的时候, 先更新数据库, 然后再删除缓存.

复杂的缓存数据

用到缓存才去算缓存

**先更新数据库, 再删除缓存**

更新过程中, 有个线程来读取数据的话就会读到缓存, 这是旧数据

缓存删除失败, 数据不一致怎么办


**先删除缓存, 再更新数据库**

删除失败更新吗?

先删除缓存, 在准备更新数据库时, 另一个请求过来, 查询缓存, 缓存为空, 然后读取数据库, 写入缓存, 然后刚才的更新操作完成, 于是缓存和数据库不一致

双删策略: 先删除缓存, 更新数据库, 预计数据库更新需要时间t, 然后在提交数据库更新t时间后再次删除缓存

一致性要求高: 内存队列排队
